<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <!-- css bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    body {
      height: 100vh;
      background-color: oklch(0.97 0.014 254.604);
    }

    main {
      height: 100%;
    }

    #card {
      height: fit-content;
      background-color: #fff;
      padding: 12px;
    }

    #btn-map {
      padding: 6px 6px;
    }

    #current_time {
      font-size: 1.25rem;
      color: gray;
    }

    .celcius {
      font-size: 4.5rem;
    }

    #description_weather {
      font-size: 30px;
      margin-bottom: 12px;
    }

    #status-weather {
      width: 100%;
    }

    #weather-section {
      gap: 24px;
    }

    #row-card-daily {
      background-color: rgb(85, 150, 246);
      border-radius: 20px;
    }

    .card_weather_days {
      height: fit-content;
      background-color: transparent;
    }

    .card-weather-days-nonactive {
      height: fit-content;
      color: oklch(0.556 0 0);
    }

    .card-body {
      padding: 24px;
    }

    #icons-weather {
      width: 40%;
    }

    .name-status-weather {
      color: gray;
      font-size: 1.25rem;
      margin-bottom: 7px;
    }

    .status-weather {
      color: black;
      font-size: 1.5rem;
      margin-bottom: 0;
    }

    .name-status-weather-days {
      font-size: 1.125rem;
      margin-bottom: 0;
      color: oklch(0.923 0.003 48.717);
    }

    .status-weather-days {
      font-size: 1.25rem;
      margin-bottom: 0;
      color: rgb(255, 255, 255);
    }
    @media screen and (min-width: 768px) {
      main {
        justify-content: center;
      }

      #weather-section {
        gap: 0;
      }

      #card {
        padding: 24px;
      }
    }

    @media screen and (min-width: 1024px) {
      #card {
        padding: 48px;
      }
    }
  </style>

  <body>
    <main class="container d-flex flex-column">
      <div id="card" class="rounded-3">
        <nav class="navbar navbar-expand gap-2 mb-5">
          <form
            id="form-search-city"
            class="d-flex gap-2 fs-6 text text-nowrap align-items-center"
          >
            Search location
            <input
              type="text"
              class="form-control border-secondary"
              name="city"
              id="search_City"
            />
          </form>
          <button
            id="location-user"
            type="button"
            class="btn btn-outline-secondary"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              style="width: 24px"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="feather feather-map-pin"
            >
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
          </button>
        </nav>

        <div
          id="weather-section"
          class="row justify-content-center justify-content-md-between"
        >
          <div
            class="col-12 col-md-4 d-flex flex-column gap-3 justify-content-center align-items-center"
          >
            <p
              id="current_time"
              class="placeholder-glow d-flex justify-content-center text-center"
              style="width: 100%"
            >
              <span class="placeholder" style="height: 25px; width: 80%"></span>
            </p>
            <div
              id="icons-weather-today"
              class="d-flex justify-content-evenly align-items-center placeholder-glow"
            >
              <img
                aria-hidden="true"
                id="current_icon_weather"
                class="placeholder"
                style="height: 96px; width: 96px"
                src="..."
                alt="..."
              />
              <div id="current_temperature_2m" class="d-flex">
                <span
                  class="placeholder"
                  style="height: 96px; width: 96px"
                ></span>
              </div>
            </div>
            <h1
              id="description_weather"
              class="fw-bold d-flex justify-content-center placeholder-glow"
              style="width: 100%"
            >
              <span class="placeholder" style="height: 30px; width: 30%"></span>
            </h1>
            <span id="status-weather" class="d-flex justify-content-evenly">
              <div class="d-flex flex-column align-items-center">
                <p class="name-status-weather">Humidity</p>
                <p
                  id="current_relative_humidity_2m"
                  class="status-weather placeholder-glow"
                >
                  <span
                    class="placeholder"
                    style="height: 30px; width: 36px"
                  ></span>
                </p>
              </div>
              <div class="d-flex flex-column align-items-center">
                <p class="name-status-weather">Wind speed</p>
                <p
                  id="current_wind_speed_10m"
                  class="status-weather placeholder-glow"
                >
                  <span
                    class="placeholder"
                    style="height: 30px; width: 64px"
                  ></span>
                </p>
              </div>
            </span>
          </div>

          <!-- card -->
          <div id="row-card-daily" class="col-12 col-md-8 row">
            <!-- card nomer 1 -->
            <div class="card_weather_days card col-4 border-0 text-light">
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold d-flex justify-content-center"
                  style="margin-bottom: 0; width: 100%"
                >
                  <span
                    class="placeholder"
                    style="height: 24px; width: 40%"
                  ></span>
                </h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather placeholder"
                  src="..."
                  alt="..."
                  style="height: 64px; width: 64px; margin: 35px"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days">Temperature</p>
                  <span
                    class="maximum_apparent_temperature status-weather-days d-flex placeholder"
                    style="height: 30px; width: 34px"
                  >
                  </span>
                </div>
              </div>
            </div>

            <!-- card nomer 2 -->
            <div class="card_weather_days card col-4 border-0 text-light">
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold d-flex justify-content-center"
                  style="margin-bottom: 0; width: 100%"
                >
                  <span
                    class="placeholder"
                    style="height: 24px; width: 40%"
                  ></span>
                </h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather placeholder"
                  src="..."
                  alt="..."
                  style="height: 64px; width: 64px; margin: 35px"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days">Temperature</p>
                  <span
                    class="maximum_apparent_temperature status-weather-days d-flex placeholder"
                    style="height: 30px; width: 34px"
                  >
                  </span>
                </div>
              </div>
            </div>
            <!-- card nomer 1 -->
            <div class="card_weather_days card col-4 border-0 text-light">
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold d-flex justify-content-center"
                  style="margin-bottom: 0; width: 100%"
                >
                  <span
                    class="placeholder"
                    style="height: 24px; width: 40%"
                  ></span>
                </h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather placeholder"
                  src="..."
                  alt="..."
                  style="height: 64px; width: 64px; margin: 35px"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days">Temperature</p>
                  <span
                    class="maximum_apparent_temperature status-weather-days d-flex placeholder"
                    style="height: 30px; width: 34px"
                  >
                  </span>
                </div>
              </div>
            </div>

            <!-- card nomer 2 -->
            <div class="card_weather_days card col-4 border-0 text-light">
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold d-flex justify-content-center"
                  style="margin-bottom: 0; width: 100%"
                >
                  <span
                    class="placeholder"
                    style="height: 24px; width: 40%"
                  ></span>
                </h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather placeholder"
                  src="..."
                  alt="..."
                  style="height: 64px; width: 64px; margin: 35px"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days">Temperature</p>
                  <span
                    class="maximum_apparent_temperature status-weather-days d-flex placeholder"
                    style="height: 30px; width: 34px"
                  >
                  </span>
                </div>
              </div>
            </div>
            <!-- card nomer 1 -->
            <div class="card_weather_days card col-4 border-0 text-light">
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold d-flex justify-content-center"
                  style="margin-bottom: 0; width: 100%"
                >
                  <span
                    class="placeholder"
                    style="height: 24px; width: 40%"
                  ></span>
                </h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather placeholder"
                  src="..."
                  alt="..."
                  style="height: 64px; width: 64px; margin: 35px"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days">Temperature</p>
                  <span
                    class="maximum_apparent_temperature status-weather-days d-flex placeholder"
                    style="height: 30px; width: 34px"
                  >
                  </span>
                </div>
              </div>
            </div>

            <!-- card nomer 2 -->
            <div class="card_weather_days card col-4 border-0 text-light">
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold d-flex justify-content-center"
                  style="margin-bottom: 0; width: 100%"
                >
                  <span
                    class="placeholder"
                    style="height: 24px; width: 40%"
                  ></span>
                </h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather placeholder"
                  src="..."
                  alt="..."
                  style="height: 64px; width: 64px; margin: 35px"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days">Temperature</p>
                  <span
                    class="maximum_apparent_temperature status-weather-days d-flex placeholder"
                    style="height: 30px; width: 34px"
                  >
                  </span>
                </div>
              </div>
            </div>
          </div>
          <!-- end card -->
        </div>
      </div>
    </main>

    <!-- script bootstrap 5 -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- icons weather code -->
    <script src="descriptions.js"></script>

    <!-- script code -->
    <script>
      const SEARCH_CITY = document.getElementById("search_City");
      // const Location_user = document.getElementById("location-user");

      // Get DOM for current day
      const CURRENT_TIME = document.getElementById("current_time");
      const CURRENT_ICON_WEATHER = document.getElementById(
        "current_icon_weather"
      );
      const CURRENT_TEMPERATURE_2M = document.getElementById(
        "current_temperature_2m"
      );
      const CURRENT_DESCRIPTION_WEATHER = document.getElementById(
        "description_weather"
      );
      const CURRENT_RELATIVE_HUMIDITY_2M = document.getElementById(
        "current_relative_humidity_2m"
      );
      const CURRENT_WIND_SPEED_10M = document.getElementById(
        "current_wind_speed_10m"
      );

      // Get DOM for daily
      const CARD_DAILY = document.querySelectorAll(".card_weather_days");
      const LOADING_DAILY = document.getElementById("loading_daily");
      const DAILY_DAY = document.querySelectorAll(".daily_day");
      const DAILY_ICON_WEATHER = document.querySelectorAll(
        ".daily_icon_weather"
      );
      const DAILY_APPARENT_TEMPERATURE = document.querySelectorAll(
        ".maximum_apparent_temperature"
      );

      document
        .querySelector("#form-search-city")
        .addEventListener("submit", () => {
          event.preventDefault();
          getCityDataByName(SEARCH_CITY.value);
        });

      document.querySelector("#location-user").addEventListener("click", () => {
        event.preventDefault();
        navigator.geolocation.getCurrentPosition((position) => {
          getCityDataByLatLon(
            position.coords.latitude,
            position.coords.longitude
          );
          getWeather(position.coords.latitude, position.coords.longitude);
        });
      });

      document.addEventListener("DOMContentLoaded", () => {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            getCityDataByLatLon(
              position.coords.latitude,
              position.coords.longitude
            );
            getWeather(position.coords.latitude, position.coords.longitude);
          },
          (error) => {
            getCityDataByName("Indonesia");
            SEARCH_CITY.value = "Indonesia";
          }
        );
      });

      const getCityDataByLatLon = async (latitude, longitude) => {
        const GET_CITY_URL = `https://nominatim.openstreetmap.org/reverse.php?lat=${latitude}&lon=${longitude}&zoom=10&format=jsonv2`;
        const response = await fetch(GET_CITY_URL);
        const json = await response.json();
        const city = json.address.city;
        SEARCH_CITY.value = city;
      };

      const getCityDataByName = async (NAME_CITY) => {
        const GET_CITY_URL = `https://geocoding-api.open-meteo.com/v1/search?name=${NAME_CITY}&count=1&language=en&format=json`;
        const response = await fetch(GET_CITY_URL);
        const json = await response.json();
        const data = json.results[0];
        getWeather(data.latitude, data.longitude);
      };

      const getWeatherData = async (latitude, longitude) => {
        const GET_WEATHER_URL = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=weather_code,apparent_temperature_max&hourly=temperature_2m&current=temperature_2m,wind_speed_10m,relative_humidity_2m,weather_code`;
        const response = await fetch(GET_WEATHER_URL);
        const json = await response.json();
        return json;
      };

      const CURRENT_TIME_FORMATER = (value) => {
        const OPTIONS = {
          hour: "numeric",
          minute: "numeric",
          hour12: true,
          weekday: "long",
          month: "short",
          day: "numeric",
          year: "numeric",
        };

        const NEW_TIME = new Date(value);
        return NEW_TIME.toLocaleDateString("en-US", OPTIONS);
      };

      const DAILY_TIME_FORMATER = (value) => {
        const OPTION = {
          weekday: "long",
        };

        const NEW_TIME = new Date(value);
        return NEW_TIME.toLocaleDateString("en-US", OPTION);
      };

      const dataLoading = () => {
        CURRENT_TIME.innerHTML = `<span class="placeholder" style="height: 25px; width: 80%"></span>`;

        CURRENT_ICON_WEATHER.src = "...";
        CURRENT_ICON_WEATHER.style = "height: 96px; width: 96px";
        CURRENT_ICON_WEATHER.classList.add("placeholder");

        CURRENT_TEMPERATURE_2M.innerHTML = `<span
                  class="placeholder"
                  style="height: 96px; width: 96px"
                ></span`;

        CURRENT_DESCRIPTION_WEATHER.innerHTML = `<span class="placeholder" style="height: 30px; width: 30%"></span>`;

        CURRENT_RELATIVE_HUMIDITY_2M.innerHTML = `<span
                    class="placeholder"
                    style="height: 30px; width: 36px"
                  ></span>`;

        CURRENT_WIND_SPEED_10M.innerHTML = `<span
                    class="placeholder"
                    style="height: 30px; width: 64px"
                  ></span>`;

        for (let i = 0; i < 6; i++) {
          DAILY_DAY[i].innerHTML = `<span
                    class="placeholder"
                    style="height: 24px; width: 40%"
                  ></span>`;

          DAILY_ICON_WEATHER[i].src = "...";
          DAILY_ICON_WEATHER[i].classList.add("placeholder");
          DAILY_ICON_WEATHER[i].style =
            "height: 64px; width: 64px; margin: 35px";

          DAILY_APPARENT_TEMPERATURE[i].classList.add("placeholder");
          DAILY_APPARENT_TEMPERATURE[i].style = "height: 30px; width: 34px";
        }
      };

      const dataBinding = (dataWeather) => {
        CURRENT_TIME.innerText = CURRENT_TIME_FORMATER(
          dataWeather.current.time
        );

        CURRENT_ICON_WEATHER.style = "height: 144px; width: 144px";
        CURRENT_ICON_WEATHER.classList.remove("placeholder");
        CURRENT_ICON_WEATHER.src =
          icons_weather[dataWeather.current.weather_code].day.image;

        CURRENT_TEMPERATURE_2M.innerHTML = `<h1 id="celcius">${dataWeather.current.temperature_2m}</h1>
                <h5>°C</h5>`;

        CURRENT_DESCRIPTION_WEATHER.innerText =
          icons_weather[dataWeather.current.weather_code].day.description;

        CURRENT_RELATIVE_HUMIDITY_2M.innerText = `${dataWeather.current.relative_humidity_2m}%`;

        CURRENT_WIND_SPEED_10M.innerText = `${dataWeather.current.wind_speed_10m} km/h`;

        for (let i = 0; i < 6; i++) {
          DAILY_DAY[i].innerText = DAILY_TIME_FORMATER(
            dataWeather.daily.time[i + 1]
          );

          DAILY_ICON_WEATHER[i].classList.remove("placeholder");
          DAILY_ICON_WEATHER[i].style = "width: 70%";
          DAILY_ICON_WEATHER[i].src =
            icons_weather[dataWeather.daily.weather_code[i + 1]].day.image;

          DAILY_APPARENT_TEMPERATURE[i].classList.remove("placeholder");
          DAILY_APPARENT_TEMPERATURE[i].style = "";
          DAILY_APPARENT_TEMPERATURE[i].innerHTML = `${Math.round(
            dataWeather.daily.apparent_temperature_max[i + 1]
          )}<p style="font-size: 13px">&#8451;</p>`;
        }
      };

      async function getWeather(latitude, longitude) {
        dataLoading();

        try {
          const dataWeather = await getWeatherData(latitude, longitude);

          dataBinding(dataWeather);
        } catch (error) {
          console.error(error);
        }
      }
    </script>
  </body>
</html>
