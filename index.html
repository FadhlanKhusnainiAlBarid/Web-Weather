<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <!-- css bootstrap 5 -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    body {
      height: 100vh;
      background-color: oklch(0.97 0.014 254.604);
    }

    main {
      height: 100%;
    }

    #card {
      height: fit-content;
      background-color: #fff;
      padding: 12px;
    }

    #btn-map {
      padding: 6px 6px;
    }

    #current_time {
      font-size: 1.25rem;
      color: gray;
    }

    .celcius {
      font-size: 4.5rem;
    }

    #description_weather {
      font-size: 30px;
      margin-bottom: 12px;
    }

    #status-weather {
      width: 100%;
    }

    #weather-section {
      gap: 24px;
    }

    #row-card-daily {
      background-color: rgb(85, 150, 246);
      border-radius: 20px;
    }

    .card_weather_days {
      height: fit-content;
      /* background-color: rgb(85, 150, 246); */
      background-color: transparent;
    }

    .card-weather-days-nonactive {
      height: fit-content;
      color: oklch(0.556 0 0);
    }

    .card-body {
      padding: 24px;
    }

    #icons-weather {
      width: 40%;
    }

    .name-status-weather {
      color: gray;
      font-size: 1.25rem;
      margin-bottom: 7px;
    }

    .status-weather {
      color: black;
      font-size: 1.5rem;
      margin-bottom: 0;
    }

    .name-status-weather-days {
      font-size: 1.125rem;
      margin-bottom: 0;
      color: oklch(0.923 0.003 48.717);
    }

    /* .nswd-nonactive {
      color: oklch(0.709 0.01 56.259);
    } */

    .status-weather-days {
      font-size: 1.25rem;
      margin-bottom: 0;
      color: rgb(255, 255, 255);
    }

    /* .nswd-active {
      color: oklch(0.923 0.003 48.717);
    }

    .swd-active {
      color: rgb(255, 255, 255);
    } */

    @media screen and (min-width: 768px) {
      main {
        justify-content: center;
      }

      #weather-section {
        gap: 0;
      }

      #card {
        padding: 24px;
      }
    }

    @media screen and (min-width: 1024px) {
      #card {
        padding: 48px;
      }
    }
  </style>

  <body>
    <main class="container d-flex flex-column">
      <div id="card" class="rounded-3">
        <nav class="navbar navbar-expand mb-5">
          <form
            id="form-search-city"
            class="d-flex gap-2 fs-6 text text-nowrap align-items-center"
          >
            Search location
            <input
              type="text"
              class="form-control border-dark-subtle"
              name="city"
              id="search_City"
            />
            <button type="submit" style="display: none">hidden</button>
          </form>
        </nav>

        <div
          id="weather-section"
          class="row justify-content-center justify-content-md-between"
        >
          <div
            class="col-12 col-md-4 d-flex flex-column gap-3 justify-content-center align-items-center"
          >
            <!-- <p id="current_time"></p> -->
            <p
              id="current_time"
              class="placeholder-glow d-flex justify-content-center"
              style="width: 100%"
            >
              <!-- <span class="placeholder" style="width: 70%"></span> -->
              <!-- <p id="current_time">13n0i130n</p> -->
            </p>
            <div
              id="icons-weather-today"
              class="d-flex justify-content-evenly align-items-center placeholder-glow"
            >
              <img
                aria-hidden="true"
                id="current_icon_weather"
                src="..."
                alt="..."
              />
              <div id="current_temperature_2m" class="d-flex">
                <!-- <span
                  class="placeholder"
                  style="height: 96px; width: 96px"
                ></span> -->
                <!-- <h1 class="celcius">72</h1>
                <h1>Â°C</h1> -->
              </div>
            </div>
            <h1 id="description_weather" class="fw-bold placeholder-glow">
              <!-- <span class="placeholder" style="height: 96px; width: 64px;"></span> -->
            </h1>
            <span id="status-weather" class="d-flex justify-content-evenly">
              <div class="d-flex flex-column align-items-center">
                <p class="name-status-weather">Humidity</p>
                <p
                  id="current_relative_humidity_2m"
                  class="status-weather placeholder-glow"
                >
                  <!-- <span
                  class="placeholder"
                  style="height: 36px; width: 36px"
                ></span> -->
                </p>
              </div>
              <div class="d-flex flex-column align-items-center">
                <p class="name-status-weather">Wind speed</p>
                <p
                  id="current_wind_speed_10m"
                  class="status-weather placeholder-glow"
                >
                  <!-- <span
                  class="placeholder"
                  style="height: 106px; width: 36px"
                ></span> -->
                </p>
              </div>
            </span>
          </div>

          <!-- card -->
          <div id="row-card-daily" class="col-12 col-md-8 row">
            <div
              class="card_weather_days card col-6 col-sm-4 col-md-4 col-xl-3 border-0 text-light"
            >
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold"
                  style="margin-bottom: 0"
                ></h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather"
                  src="..."
                  alt="..."
                  style="width: 70%"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days nswd-active">
                    Temperature
                  </p>
                  <span class="d-flex gap-3">
                    <span
                      class="daily_temperature_2m_max status-weather-days d-flex"
                    >
                    </span>
                    <span
                      class="daily_temperature_2m_min status-weather-days d-flex"
                    ></span>
                  </span>
                </div>
              </div>
            </div>
            <div
              class="card_weather_days card col-6 col-sm-4 col-md-4 col-xl-3 border-0 text-light"
            >
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold"
                  style="margin-bottom: 0"
                ></h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather"
                  src="..."
                  alt="..."
                  style="width: 70%"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days nswd-nonactive">
                    Temperature
                  </p>
                  <span class="d-flex gap-3">
                    <span
                      class="daily_temperature_2m_max status-weather-days d-flex"
                    >
                    </span>
                    <span
                      class="daily_temperature_2m_min status-weather-days d-flex"
                    ></span>
                  </span>
                </div>
              </div>
            </div>
            <div
              class="card_weather_days card col-6 col-sm-4 col-md-4 col-xl-3 border-0 text-light"
            >
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold"
                  style="margin-bottom: 0"
                ></h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather"
                  src="..."
                  alt="..."
                  style="width: 70%"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days nswd-nonactive">
                    Temperature
                  </p>
                  <span class="d-flex gap-3">
                    <span
                      class="daily_temperature_2m_max status-weather-days d-flex"
                    >
                    </span>
                    <span
                      class="daily_temperature_2m_min status-weather-days d-flex"
                    ></span>
                  </span>
                </div>
              </div>
            </div>
            <div
              class="card_weather_days card col-6 col-sm-4 col-md-4 col-xl-3 border-0 text-light"
            >
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold"
                  style="margin-bottom: 0"
                ></h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather"
                  src="..."
                  alt="..."
                  style="width: 70%"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days nswd-nonactive">
                    Temperature
                  </p>
                  <span class="d-flex gap-3">
                    <span
                      class="daily_temperature_2m_max status-weather-days d-flex"
                    >
                    </span>
                    <span
                      class="daily_temperature_2m_min status-weather-days d-flex"
                    ></span>
                  </span>
                </div>
              </div>
            </div>
            <div
              class="card_weather_days card col-6 col-sm-4 col-md-4 col-xl-3 border-0 text-light"
            >
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold"
                  style="margin-bottom: 0"
                ></h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather"
                  src="..."
                  alt="..."
                  style="width: 70%"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days nswd-nonactive">
                    Temperature
                  </p>
                  <span class="d-flex gap-3">
                    <span
                      class="daily_temperature_2m_max status-weather-days d-flex"
                    >
                    </span>
                    <span
                      class="daily_temperature_2m_min status-weather-days d-flex"
                    ></span>
                  </span>
                </div>
              </div>
            </div>
            <div
              class="card_weather_days card col-6 col-sm-4 col-md-4 col-xl-3 border-0 text-light"
            >
              <div class="card-body d-flex flex-column align-items-center">
                <h5
                  class="daily_day card-title fs-5 fw-bold"
                  style="margin-bottom: 0"
                ></h5>

                <img
                  aria-hidden="true"
                  class="daily_icon_weather"
                  src="..."
                  alt="..."
                  style="width: 70%"
                />

                <div class="card-text d-flex flex-column align-items-center">
                  <p class="name-status-weather-days nswd-nonactive">
                    Temperature
                  </p>
                  <span class="d-flex gap-3">
                    <span
                      class="daily_temperature_2m_max status-weather-days d-flex"
                    >
                    </span>
                    <span
                      class="daily_temperature_2m_min status-weather-days d-flex"
                    ></span>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <!-- end card -->
        </div>
      </div>
    </main>

    <!-- script bootstrap 5 -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- icons weather code -->
    <script src="descriptions.js"></script>

    <!-- script code -->
    <script>
      const SEARCH_CITY = document.getElementById("search_City");

      // Get DOM for current day
      const CURRENT_TIME = document.getElementById("current_time");
      const CURRENT_ICON_WEATHER = document.getElementById(
        "current_icon_weather"
      );
      const CURRENT_TEMPERATURE_2M = document.getElementById(
        "current_temperature_2m"
      );
      const CURRENT_DESCRIPTION_WEATHER = document.getElementById(
        "description_weather"
      );
      const CURRENT_RELATIVE_HUMIDITY_2M = document.getElementById(
        "current_relative_humidity_2m"
      );
      const CURRENT_WIND_SPEED_10M = document.getElementById(
        "current_wind_speed_10m"
      );

      // Get DOM for daily
      const ROW_CARD_DAILY = document.getElementById("row-card-daily");
      const CARD_DAILY = document.querySelectorAll(".card_weather_days");
      const LOADING_DAILY = document.getElementById("loading_daily");
      const DAILY_DAY = document.querySelectorAll(".daily_day");
      const DAILY_ICON_WEATHER = document.querySelectorAll(
        ".daily_icon_weather"
      );
      const DAILY_TEMPERATURE_2M_MAX = document.querySelectorAll(
        ".daily_temperature_2m_max"
      );
      const DAILY_TEMPERATURE_2M_MIN = document.querySelectorAll(
        ".daily_temperature_2m_min"
      );

      document
        .querySelector("#form-search-city")
        .addEventListener("submit", () => {
          event.preventDefault();
          getCityDataByName(SEARCH_CITY.value);
        });

      document.addEventListener("DOMContentLoaded", () => {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            getCityDataByLatLon(
              position.coords.latitude,
              position.coords.longitude
            );
            getWeather(position.coords.latitude, position.coords.longitude);
            console.log(position.coords.latitude, position.coords.longitude);
          },
          (error) => {
            // console.log("location di tolak");
            getCityDataByName("Indonesia");
            SEARCH_CITY.value = "Indonesia";
          }
        );
      });

      // https://nominatim.openstreetmap.org/reverse.php?lat=23.05277&lon=283.12500&zoom=10&format=jsonv2

      const getCityDataByLatLon = async (latitude, longitude) => {
        const GET_CITY_URL = `https://nominatim.openstreetmap.org/reverse.php?lat=${latitude}&lon=${longitude}&zoom=10&format=jsonv2`;
        const response = await fetch(GET_CITY_URL);
        const json = await response.json();
        console.log(json);
        const city = json.address.region;
        SEARCH_CITY.value = city;
      };

      const getCityDataByName = async (NAME_CITY) => {
        const GET_CITY_URL = `https://geocoding-api.open-meteo.com/v1/search?name=${NAME_CITY}&count=1&language=en&format=json`;
        const response = await fetch(GET_CITY_URL);
        const json = await response.json();
        const data = json.results[0];
        getWeather(data.latitude, data.longitude);
      };

      const getWeatherData = async (latitude, longitude) => {
        const GET_WEATHER_URL = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=weather_code,temperature_2m_max,temperature_2m_min&current=temperature_2m,wind_speed_10m,relative_humidity_2m,weather_code`;
        const response = await fetch(GET_WEATHER_URL);
        const json = await response.json();
        return json;
      };

      const CURRENT_TIME_FORMATER = (value) => {
        const OPTIONS = {
          hour: "numeric",
          minute: "numeric",
          hour12: true,
          weekday: "long",
          month: "short",
          day: "numeric",
          year: "numeric",
        };

        const NEW_TIME = new Date(value);
        return NEW_TIME.toLocaleDateString("en-US", OPTIONS);
      };

      const DAILY_TIME_FORMATER = (value) => {
        const OPTION = {
          weekday: "long",
        };

        const NEW_TIME = new Date(value);
        return NEW_TIME.toLocaleDateString("en-US", OPTION);
      };

      const changeDomContent = () => {};

      async function getWeather(latitude, longitude) {
        try {
          const dataWeather = await getWeatherData(latitude, longitude);
          console.log(dataWeather);
        } catch (error) {
          console.error(error);
        }
      }

      // async function getWeather() {
      //   event.preventDefault();
      //   const NAME_CITY = SEARCH_CITY.value;

      //   CURRENT_TIME.innerHTML = `<span class="placeholder" style="height: 30px;width: 70%"></span>`;

      //   CURRENT_ICON_WEATHER.src = "...";
      //   CURRENT_ICON_WEATHER.style = "width: 96px; height: 96px";
      //   CURRENT_ICON_WEATHER.className = "placeholder";

      //   CURRENT_DESCRIPTION_WEATHER.innerHTML = `<span class="placeholder" style="height: 36px; width: 96px;"></span>`;

      //   CURRENT_TEMPERATURE_2M.innerHTML = `<span
      //             class="placeholder"
      //             style="height: 96px; width: 96px"
      //           ></span>`;

      //   CURRENT_RELATIVE_HUMIDITY_2M.innerHTML = `<span
      //             class="placeholder"
      //             style="height: 36px; width: 36px"
      //           ></span>`;

      //   ROW_CARD_DAILY.classList.add(
      //     "justify-content-center",
      //     "align-items-center"
      //   );

      //   for (let i = 0; i < 6; i++) {
      //     CARD_DAILY[i].style = "display: none";
      //   }

      //   CURRENT_WIND_SPEED_10M.innerHTML = `<span
      //             class="placeholder"
      //             style="height: 36px; width: 106px"
      //           ></span>`;

      //   LOADING_DAILY.style = "height: 122px; width: 122px; padding: 0";

      //   try {
      //     const JSON_GEOCODING = await getCityData(NAME_CITY);
      //     const DATA_CITY = JSON_GEOCODING.results[0];

      //     // const RESPONSE_WEATHER_FORECAST = await getWeatherData(
      //     //   DATA_CITY.latitude,
      //     //   DATA_CITY.longitude
      //     // );
      //     const DATA_WEATHER = await getWeatherData(
      //       DATA_CITY.latitude,
      //       DATA_CITY.longitude
      //     );

      //     // placeing data to DOM
      //     // Lorem ipsum dolor sit amet consectetur adipisicing elit. Reprehenderit molestiae at quia error. Animi ea maxime voluptate vitae, iusto quasi necessitatibus sint unde praesentium cum odio consequuntur qui veniam possimus.
      //     if (DATA_WEATHER) {
      //       CURRENT_ICON_WEATHER.className = "";
      //       CURRENT_ICON_WEATHER.style = "width: 160px";

      //       CURRENT_TIME.innerText = CURRENT_TIME_FORMATER(
      //         DATA_CITY.country_code,
      //         DATA_WEATHER.current.time
      //       );

      //       CURRENT_ICON_WEATHER.src =
      //         icons_weather[DATA_WEATHER.current.weather_code].day.image;

      //       CURRENT_TEMPERATURE_2M.innerHTML = `<h1 class="celcius">${Math.round(
      //         DATA_WEATHER.current.temperature_2m
      //       )}</h1>
      //           <h1>&#8451;</h1>`;

      //       CURRENT_DESCRIPTION_WEATHER.innerText =
      //         icons_weather[DATA_WEATHER.current.weather_code].day.description;

      //       CURRENT_RELATIVE_HUMIDITY_2M.innerText =
      //         DATA_WEATHER.current.relative_humidity_2m +
      //         DATA_WEATHER.current_units.relative_humidity_2m;

      //       CURRENT_WIND_SPEED_10M.innerText =
      //         DATA_WEATHER.current.wind_speed_10m +
      //         DATA_WEATHER.current_units.wind_speed_10m;

      //       ROW_CARD_DAILY.classList.remove(
      //         "justify-content-center",
      //         "align-items-center"
      //       );
      //       LOADING_DAILY.style = "display: none";
      //       DATA_WEATHER.daily.time.forEach((_, index) => {
      //         if (index < 6) {
      //           CARD_DAILY[index].style = "display: block";
      //           DAILY_DAY[index].innerText = DAILY_TIME_FORMATER(
      //             DATA_CITY.country_code,
      //             DATA_WEATHER.daily.time[index + 1]
      //           );

      //           DAILY_ICON_WEATHER[index].src =
      //             icons_weather[
      //               DATA_WEATHER.daily.weather_code[index + 1]
      //             ].day.image;

      //           DAILY_TEMPERATURE_2M_MAX[index].innerHTML = `${Math.round(
      //             DATA_WEATHER.daily.temperature_2m_max[index + 1]
      //           )}<p style="font-size: 13px">&#8451;</p>`;

      //           DAILY_TEMPERATURE_2M_MIN[index].innerHTML = `${Math.round(
      //             DATA_WEATHER.daily.temperature_2m_max[index + 1]
      //           )}<p style="font-size: 13px">&#8451;</p>`;
      //         }
      //       });
      //     }

      //     console.log(DATA_CITY);
      //     console.log(DATA_WEATHER);
      //     console.log(icons_weather);
      //   } catch (error) {
      //     console.error(error);
      //     console.log("Kota tidak di temukan");
      //   }
      //   // navigator.geolocation.getCurrentPosition((position) => {
      //   //   doSomething(position.coords.latitude, position.coords.longitude);
      //   // });
      // }
    </script>
  </body>
</html>
